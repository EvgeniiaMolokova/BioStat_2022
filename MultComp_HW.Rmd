---
title: "MultComp_HW"
author: "Evgeniia Molokova"
date: "2022-11-22"
output: html_document
---

# Настройка библиотек 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
```


&nbsp;


&nbsp;

# 1. Загрузка данных и создание исследуемой выборки 
```{r}
soccer_general <- read.csv("C:/Users/Евгения/Downloads/soccer.csv", sep=";")[, 2:6] %>%
  mutate(Position = as.factor(Position),
         Nationality = as.factor(Nationality),
         Age = as.numeric(Age),
         Height = as.numeric(Height)) %>%
  filter(Nationality %in% c("Spanish", "Italian", "German", "English", "Argentinian"))

set.seed(1)

soccer_wrk <- soccer_general[sample(1:nrow(soccer_general), 150), ] %>%
  mutate(Nationality = factor(Nationality))
```


&nbsp;


&nbsp;

# 2. Создание переменных по выборке (вектор значений роста по каждой позиции); по генеральной совокупности (истинные средние значения роста по каждой позиции)
```{r}
a <- soccer_wrk %>% filter(Position == "Defender") %>% pull(Height) # вектор значений переменной Рост у Защитников

b <- soccer_wrk %>% filter(Position == "Midfielder") %>% pull(Height) # вектор значений переменной Рост у Полузащитников

c <- soccer_wrk %>% filter(Position == "Goalkeeper") %>% pull(Height) # вектор значений переменной Рост у Вратарей

d <- soccer_wrk %>% filter(Position == "Forward") %>% pull(Height) # вектор значений переменной Рост у Нападающих


atrue <- soccer_general %>% filter(Position == "Defender") %>% pull(Height) %>% mean(na.rm = TRUE) #истинное среднее значение Роста (в генеральной совокупности) у Защитников

btrue <- soccer_general %>% filter(Position == "Midfielder") %>% pull(Height) %>% mean(na.rm = TRUE) #истинное среднее значение Роста (в генеральной совокупности) у Полузащитников

ctrue <-  soccer_general %>% filter(Position == "Goalkeeper") %>% pull(Height) %>% mean(na.rm = TRUE) #истинное среднее значение Роста (в генеральной совокупности) у Вратарей

dtrue <- soccer_general %>% filter(Position == "Forward") %>% pull(Height) %>% mean(na.rm = TRUE) #истинное среднее значение Роста (в генеральной совокупности) у Нападающих
```

&nbsp;


&nbsp;

# ДИ для разницы между средними без поправки и с проправкой Бонферонни (для каждого из 6 интервалов alpha adj. = 0.05/6 = 0.008)
```{r}
atrue - btrue #Истинное значение разницы средних между Защитниками и Полузащитниками

t.test(a,b)%>% with (conf.int) #ДИ построенный для разницы средних по выборке

t.test (a,b, conf.level = 0.992) %>% with (conf.int) #ДИ построенный для разницы средних по выборке с поправкой Бонферонни

```
 Вывод: ДИ без поправки и с поправкой покрывает истинную разницу средних. ДИ с поправкой Бонферонни "шире".

&nbsp;


&nbsp;

# ДИ для разницы между средними без поправки и с проправкой Бонферонни (для каждого из 6 интервалов alpha adj. = 0.05/6 = 0.008)
```{r}
ctrue - atrue #Истинное значение разницы средних между Защитниками и Вратарями

t.test(c,a)%>% with (conf.int) #ДИ построенный для разницы средних по выборке

t.test (c,a, conf.level = 0.992) %>% with (conf.int) #ДИ построенный для разницы средних по выборке с поправкой Бонферонни

```
 Вывод: ДИ без поправки и с поправкой покрывает истинную разницу средних. ДИ с поправкой Бонферонни "шире".

&nbsp;


&nbsp;

# ДИ для разницы между средними без поправки и с проправкой Бонферонни (для каждого из 6 интервалов alpha adj. = 0.05/6 = 0.008)
```{r}
atrue - dtrue #Истинное значение разницы средних между Защитниками и Нападающими

t.test(a,d)%>% with (conf.int) #ДИ построенный для разницы средних по выборке

t.test (a,d, conf.level = 0.992) %>% with (conf.int) #ДИ построенный для разницы средних по выборке с поправкой Бонферонни

```
 Вывод: ДИ без поправки и с поправкой покрывает истинную разницу средних. ДИ с поправкой Бонферонни "шире".Однако оба ДИ также покрывают и 0 (отсутствие разницы средних).
 
&nbsp;


&nbsp;

# ДИ для разницы между средними без поправки и с проправкой Бонферонни (для каждого из 6 интервалов alpha adj. = 0.05/6 = 0.008)
```{r}
ctrue - btrue #Истинное значение разницы средних между Полузащитниками и Вратарями

t.test(c,b)%>% with (conf.int) #ДИ построенный для разницы средних по выборке

t.test (c,b, conf.level = 0.992) %>% with (conf.int) #ДИ построенный для разницы средних по выборке с поправкой Бонферонни

```
 Вывод: ДИ без поправки и с поправкой покрывает истинную разницу средних. ДИ с поправкой Бонферонни "шире".
 
&nbsp;


&nbsp;

# ДИ для разницы между средними без поправки и с проправкой Бонферонни (для каждого из 6 интервалов alpha adj. = 0.05/6 = 0.008)
```{r}
ctrue - dtrue #Истинное значение разницы средних между Нападающими и Вратарями

t.test(c,d)%>% with (conf.int) #ДИ построенный для разницы средних по выборке

t.test (c,d, conf.level = 0.992) %>% with (conf.int) #ДИ построенный для разницы средних по выборке с поправкой Бонферонни

```
Вывод: ДИ без поправки и с поправкой покрывает истинную разницу средних. ДИ с поправкой Бонферонни "шире".

&nbsp;


&nbsp;

# ДИ для разницы между средними без поправки и с проправкой Бонферонни (для каждого из 6 интервалов alpha adj. = 0.05/6 = 0.008)
```{r}
dtrue - btrue #Истинное значение разницы средних между Нападающими и Полузащитниками

t.test(d,b)%>% with (conf.int) #ДИ построенный для разницы средних по выборке

t.test (d,b, conf.level = 0.992) %>% with (conf.int) #ДИ построенный для разницы средних по выборке с поправкой Бонферонни

```
 Вывод: ДИ без поправки и с поправкой покрывает истинную разницу средних. ДИ с поправкой Бонферонни "шире". Однако оба ДИ также покрывают 0 (отсутствие разницы средних)
 
 Таким образом, построенные по выборке ДИ покрывают истинную разницу средних в каждой паре как с использованием поправки, так и без. Однако два интервала, построенные по выборке, покрывают также 0 - отсутствие разницы средних. Это было выявлено в парах Защитники-Нападающие и Полузащитники-Нападающие. При этом истинные разницы в средних для этих пар отличны от 0 в генеральной совокупности.
 
 Визуализируем распределение переменной Рост в каждой группе в выборке и генеральной совокупности.
 
# Графическое представление
```{r}
ggplot(data=soccer_general, aes (x=Position, y=Height))+
  geom_boxplot()+
  stat_summary(fun = mean, geom="point", shape=20, size=5, color="red", fill="red")+
  theme_light()+
    ggtitle('Генеральная совокупность')

ggplot(data=soccer_wrk, aes (x=Position, y=Height))+
  geom_boxplot()+
  stat_summary(fun = mean, geom="point", shape=20, size=5, color="red", fill="red")+
  theme_light()+
    ggtitle('Выборка')


```
  
  Красным кружком отмечены средние в каждой группе.
  ДИ, построенные по выборке, покрывают 0 для двух пар: Defender и Forward, Midfielder и Forward. Это можно проинтерпретировать как отсутствие разницы средних, хотя в генеральной совокупности разность между истинными средними не равна 0. Она минимальна для пары Midfielder и Forward (0.8) 

&nbsp;


&nbsp;

# Тесты для разницы средних в каждой паре
```{r}

t.test(a,b)%>% with (p.value) 
t.test(a,c)%>% with (p.value)
t.test(a,d)%>% with (p.value)
t.test(c,b)%>% with (p.value)
t.test(c,d)%>% with (p.value)
t.test(d,b)%>% with (p.value)

```
 Вывод: по результатам тестов для разницы средних, выявлены статистически значимые разницы в средних в 4-х парах. Не отвергаем нулевую гипотезу о разнице средних равной 0 в двух парах: Midfielder и Forward, Defender и Forward, что совпадает с предположением, сделанным по ДИ (ДИ в этих парах покрывают 0).

&nbsp;


&nbsp;

# Попарные тесты для разниц между средними (с поправкой Холма)
```{r}
pairwise.t.test(soccer_wrk$Height, soccer_wrk$Position, p.adjust.method = "holm", pool.sd = FALSE)
```
 Вывод: попарный тест с поправкой Холма также выявил статистически значимые разницы в средних в 4-х парах. Не отвергаем нулевую гипотезу о разнице средних равной 0 в двух парах: Midfielder и Forward, Defender и Forward, что совпадает с результатами предыдуших тестов в парах.
 
 &nbsp;


&nbsp;

# Попарные тесты для разниц между средними (с поправкой Бенджамини-Хохберга)
```{r}
pairwise.t.test(soccer_wrk$Height, soccer_wrk$Position, p.adjust.method = "BH", pool.sd = FALSE)
```
 Вывод: попарный тест с поправкой Бенджамини-Хохберга также выявил статистически значимые разницы в средних в 4-х парах. Не отвергаем нулевую гипотезу о разнице средних равной 0 в двух парах: Midfielder и Forward, Defender и Forward, что совпадает с результатами предыдуших тестов в парах.
 Таким образом, по результатам всех тестов с поправками и без мы сделали 4 "открытия".
 
 Если посмотреть на генеральную совокупность:

# Попарные тесты для разниц между средними (с поправкой Холма) в генеральной совокупности
```{r}
pairwise.t.test(soccer_general$Height, soccer_general$Position, p.adjust.method = "holm", pool.sd = FALSE)
```
 
# Попарные тесты для разниц между средними (с поправкой Бенджамини-Хохберга) в генеральной совокупности
```{r}
pairwise.t.test(soccer_general$Height, soccer_general$Position, p.adjust.method = "BH", pool.sd = FALSE)
```
 
 Вывод: попарные тесты в генеральной совокупности выявили статистически значимые разницы в средних уже в 5 парах. Не отвергаем нулевую гипотезу о разнице средних равной 0 только в одной паре: Midfielder и Forward. 
 Таким образом, анализируя выборочные средние мы сделали одно "ложное открытие" - отсутствие разницы между средними в паре Defender- Forward
